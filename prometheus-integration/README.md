# Prometheus Integration with TIBCO BusinessWorks

Prometheus Monitoring for TIBCO BusinessWorks is an open source plug-in for TIBCO BusinessWorks. It is designed to monitor JVM, application's activity & process related statistics via [Prometheus](https://prometheus.io).

## Prometheus for Docker

To enable Prometheus monitoring for applications running in Docker follow the below steps:
* Add JAR of this plugin in /resources/addons/jars folder and build the base image (name it as bwce-base).
* Expose port 9095 in the all application's Dockerfile where Prometheus monitoring is required.
* Build the application's docker image using base image created in step 1. (i.e. bwce-base:latest)
* Set BW_PROMETHEUS_ENABLE environment variable to TRUE while running the Docker image of the application.
* Run your application using the below command: <br/>
  * docker run -d -p 9095:9095 -p exposed-port-by-application:8080 -e BW_PROMETHEUS_ENABLE=TRUE app-image-name <br/>
If monitoring multiple apps then make sure the port 9095 is mapped to different port in the container. <br />
To enable logging pass environment variable BW_LOGLEVEL=INFO|DEBUG <br/>
Now, hit the application endpoint and check the metrics here: http://your-machine-ip:9095/metrics
* Add prometheus.yml file and run the Prometheus server to scrape metrics generated in last step using the below commands: <br/>
  * cp path-to-file/prometheus.yml ~/prometheus.yml <br/> 
  * docker run -d -p 9090:9090 -v ~/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus --config.file=/etc/prometheus/prometheus.yml

## Prometheus for PCF

To enable Prometheus monitoring for applications running in PCF follow the below steps:
* Set BW_PROMETHEUS_ENABLE environment variable to TRUE in the manifest.yml file of the application.
* Add JAR of this plugin in addons/jar folder and build the buildpack.
* Push your application to the cloud using newly created buildpack. Once application gets started you would be able to see the Prometheus metrics at applications-routable-url/merics endpoint.
* Add promregator.yml file and run the Promregator server using below command: <br/> 
  * cp path-to-file/promregator.yml ~/promregator.yml <br/> 
  * docker run -d --name promregator -p 127.0.0.1:56710:8080 -v ~/promregator.yml:/etc/promregator/promregator.yml -e CF_PASSWORD=cloud-foundary-password promregator/promregator:0.4.1
* Add prometheus.yml file and run the Prometheus server using below command: <br/>
  * cp path-to-file/prometheus.yml ~/prometheus.yml <br/> 
  * docker run --name prometheus -v ~/prometheus.yml:/etc/prometheus/prometheus.yml -p 127.0.0.1:9090:9090 --link promregator prom/prometheus:latest

## Grafana Integration to Prometheus

To start Grafana in your local machine run the below command:

docker run --user root -d -p 3000:3000 -e "GF_SECURITY_ADMIN_PASSWORD=admin" -v ~/grafana_db:/var/lib/grafana grafana/grafana:5.1.0

This command will start Grafana container and it will be accessible at http://localhost:3000 with username: admin & password: admin. Add Prometheus data source and configure PromQLs to show more fancy graphs in Grafana. [Here](https://prometheus.io/docs/visualization/grafana/ "Prometheus in Grafana") are the steps to setup Prometheus in Grafana. And below is the sample dashboard that has been created using metrics generated by this plugin. To get the queries please check [here.](https://github.com/TIBCOSoftware/bw-tooling/blob/master/prometheus-integration/sample/Sample_PromQL_for_Grafana "Sample Grafana PromQL") Tips: Use multiple apps to show the variations in the graph.

![prometheus-grafana-integration](https://user-images.githubusercontent.com/44194609/49129290-25ce8180-f2f5-11e8-80f0-ea54f121cadd.png)
